# BM - 终端音乐播放器

![](image.png)

BM 是一个用 Go 语言编写的现代化终端音乐播放器，具有丰富的功能和美观的 TUI 界面。支持 FLAC、MP3、WAV、OGG 音频格式，提供专辑封面显示、播放列表管理、模糊搜索等功能。这个项目之所以存在纯粹是因为我太喜欢 [kew](https://github.com/ravachol/kew) 了，但是我并不熟悉C语言所以就用GO语言写了这个更符合我自己审美和使用习惯的终端音乐播放器。

## 特性

### 音频播放

- **多格式支持**: FLAC、MP3、WAV、OGG
- **播放控制**: 播放/暂停、快进/快退（5秒间隔）
- **音量控制**: 对数音量曲线，支持精细调节
- **速度调节**: 0.1x 到 4.0x 播放速度控制
- **高质量重采样**: 支持多种重采样质量选项

### 终端界面

- **响应式设计**: 自适应终端尺寸
- **专辑封面显示**: 支持 Kitty、Sixel、iTerm2 图像协议
- **智能配色**: 从专辑封面提取颜色用于UI
- **多页面系统**: 播放器、播放列表、媒体库三个主要页面

### 媒体管理

- **文件系统浏览**: 完整的目录导航功能
- **模糊搜索**: 支持中英文模糊匹配
- **播放列表**: 动态管理播放列表
- **播放历史**: 记录最多100条播放历史
- **损坏文件检测**: 自动标记无法播放的文件

### 系统集成

- **MPRIS2 支持**: 完整的 D-Bus MPRIS2 接口
- **桌面通知**: 歌曲切换时发送通知
- **全局快捷键**: 支持系统媒体按键
- **配置持久化**: 自动保存设置和状态

### 高度可配置

- **按键映射**: 完全自定义所有快捷键
- **播放模式**: 单曲循环、列表循环、随机播放、记忆模式
- **启动行为**: 可配置默认页面和自动播放
- **图像协议**: 自动检测或手动指定终端图像协议

## 安装

### 从源码构建

1. **安装 Go**
   
   ```bash
   # Arch Linux
   sudo pacman -S go
   ```
   
2. **克隆仓库并构建**
   
   ```bash
   git clone https://github.com/zyoung11/BM.git
   cd BM
   go build .
   ```
   
3. **安装到系统路径（可选）**
   
   ```bash
   sudo cp bm /usr/local/bin/
   ```

### 预编译二进制

从 [Releases](https://github.com/yourusername/bm/releases) 页面下载对应平台的二进制文件，赋予执行权限后即可使用。

## 使用

### 基本用法

```bash
# 启动播放器（指定音乐库目录）
bm /path/to/music/library

# 播放单个音频文件
bm /path/to/song.flac

# 启动播放器（交互式选择音乐库）
bm

# 显示帮助信息
bm help
```

### 操作指南

#### 全局快捷键
| 按键 | 功能 |
|------|------|
| `ESC` | 退出程序 |
| `TAB` | 循环切换页面 |
| `1` | 切换到播放器页面 |
| `2` | 切换到播放列表页面 |
| `3` | 切换到媒体库页面 |

#### 播放器页面
| 按键 | 功能 |
|------|------|
| `空格` | 播放/暂停 |
| `E` / `L` | 快进5秒 |
| `Q` / `H` | 快退5秒 |
| `W` / `↑` | 音量增加 |
| `S` / `↓` | 音量减少 |
| `X` / `K` | 播放速度增加 |
| `Z` / `J` | 播放速度减少 |
| `D` / `→` | 下一首歌曲 |
| `A` / `←` | 上一首歌曲 |
| `R` | 切换播放模式 |
| `C` | 切换文字颜色（封面色/白色） |
| `退格键` | 重置音量和播放速度 |

#### 媒体库页面
| 按键 | 功能 |
|------|------|
| `K` / `W` / `↑` | 向上导航 |
| `J` / `S` / `↓` | 向下导航 |
| `L` / `D` / `→` | 进入目录 |
| `H` / `A` / `←` | 退出目录 |
| `空格` | 切换选择当前项目 |
| `E` | 切换选择所有项目 |
| `F` | 进入搜索模式 |

#### 播放列表页面
| 按键 | 功能 |
|------|------|
| `K` / `W` / `↑` | 向上导航 |
| `J` / `S` / `↓` | 向下导航 |
| `空格` | 从播放列表移除歌曲 |
| `回车` | 播放选中的歌曲 |
| `F` | 进入搜索模式 |

#### 搜索模式
| 按键 | 功能 |
|------|------|
| `回车` | 确认搜索 |
| `ESC` | 退出搜索 |
| `退格键` | 删除搜索字符 |

## 配置

配置文件位于 `~/.config/BM/config.toml`，首次运行时会自动创建。

### 按键映射配置

配置文件支持完整的按键映射自定义，支持单个按键或按键列表。详细配置请参考生成的默认配置文件。

## 封面支持

### 封面来源优先级

1. 音频文件内嵌的封面
2. 同目录下的图片文件（优先选择包含 cover、folder、album 等关键词的文件）
3. 默认封面图片（`~/.config/BM/default.jpg`）

### 支持的图像格式

- JPEG/JPG
- PNG

### 终端图像协议
- **Kitty**: 现代终端（Kitty、WezTerm、Ghostty、Rio）
- **Sixel**: 传统终端支持
- **iTerm2**: macOS iTerm2 终端
- **Auto**: 自动检测最佳可用协议

## MPRIS2 集成

BM 实现了完整的 MPRIS2（Media Player Remote Interfacing Specification）接口，支持：

- 系统媒体按键控制（播放/暂停/下一首/上一首）
- 播放状态同步
- 元数据传递
- 音量控制
- 播放位置同步

## 项目结构

```
bm/
├── main.go              # 应用程序入口和核心逻辑
├── config.go            # 配置管理（TOML）
├── player.go            # 音频播放和UI渲染
├── library.go           # 媒体库浏览和管理
├── playlist.go          # 播放列表管理
├── storage.go           # 持久化存储（JSON）
├── mpris.go             # MPRIS2 D-Bus 接口
├── term_renderer.go     # 终端图像渲染
├── notification.go      # 桌面通知
├── sixel.go             # Sixel 图像编码器
├── default_config.toml  # 默认配置文件
├── default.jpg          # 默认封面图片
├── go.mod               # Go 模块定义
└── README.md            # 项目说明文档
```

## 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 致谢

感谢以下开源项目的贡献：

- [beep](https://github.com/gopxl/beep) - Go 音频播放库
- [tag](https://github.com/dhowden/tag) - 音频元数据读取
- [dbus](https://github.com/godbus/dbus) - D-Bus Go 绑定
- [go-term](https://github.com/golang/term) - 终端控制库
- [go-sixel](https://github.com/mattn/go-sixel) - Sixel 协议编解码库

---

